(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"2YfZ":function(t,n,e){"use strict";e("3SM6")},"3SM6":function(t,n,e){},"5RKo":function(t,n,e){},"912a":function(t,n,e){"use strict";e("wKo5")},A06X:function(t,n,e){"use strict";e("N2yx")},Iwxd:function(t,n,e){"use strict";e.r(n);var i=e("id0j"),s=e("M8fA"),r=e("Vql+"),o={metaInfo:{title:"Programme d'Investigation"},components:{PageTitle:i.a,PageContent:s.a,InvestigationsList:r.a}},a=e("KHd+"),u=Object(a.a)(o,(function(){var t=this.$createElement,n=this._self._c||t;return n("Layout",[n("div",{staticClass:"offres"},[n("PageTitle",[this._v("\n      Investigations\n    ")]),n("div",{staticClass:"px-4"},[n("InvestigationsList",{attrs:{promotionId:this.$route.params.id}})],1)],1)])}),[],!1,null,null,null);n.default=u.exports},M8fA:function(t,n,e){"use strict";e("UPS1");var i=e("KHd+"),s=Object(i.a)({},(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"page-content"},[this._t("default")],2)}),[],!1,null,null,null);n.a=s.exports},N2yx:function(t,n,e){},R6tD:function(t,n,e){"use strict";e("5RKo")},UPS1:function(t,n,e){"use strict";e("hshw")},"Vql+":function(t,n,e){"use strict";e("TeQF"),e("QWBl"),e("yq1k"),e("2B1R"),e("JTJg"),e("FZtP");var i=e("h4VS"),s=(e("ls82"),e("HaE+")),r={props:{id:String,name:String,pitch:String,status:String,collectivites:Array},computed:{humanizedStatus:function(){return"en_cours"===this.status?"En cours":"termine"===this.status?"Passé":"en_preparation"===this.status?"En préparation":void 0}}},o=(e("R6tD"),e("KHd+")),a=Object(o.a)(r,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"investigation-card-container"},[e("g-link",{attrs:{to:"/investigations/"+t.id}},[e("div",{staticClass:"investigation-card"},[e("div",[e("div",{staticClass:"status",class:t.status},[t._v(t._s(t.humanizedStatus))]),e("div",{directives:[{name:"g-image",rawName:"v-g-image"}],staticClass:"pitch",domProps:{innerHTML:t._s(t.pitch)}})]),e("div",{staticClass:"flex flex-row flex-1 justify-between mt-4"},[e("ul",{staticClass:"collectivites"},t._l(t.collectivites,(function(n,i){return e("li",{key:i},[t._v(t._s(n))])})),0),t.name?e("div",{directives:[{name:"g-image",rawName:"v-g-image"}],staticClass:"title",domProps:{innerHTML:t._s(t.name)}}):t._e()])])])],1)}),[],!1,null,"1a32e876",null).exports,u=(e("qePV"),e("t9QN")),c={mounted:function(){new u.Map({container:"map",style:"https://api.maptiler.com/maps/hybrid/style.json?key=".concat("get_your_own_OpIi9ZULNHzrESv6T2vL"),center:[1,15],zoom:3})}},l=(e("912a"),{components:{Carto:Object(o.a)(c,(function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"map"}})}),[],!1,null,"cd4875e8",null).exports},props:{enPreparationCount:Number,enCoursCount:Number,termineCount:Number,statusFilters:Array}}),m=(e("zvga"),Object(o.a)(l,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"font-marianne text-xl flex gap-x-8 mb-8"},[e("a",{class:{selected:t.statusFilters.includes("en_preparation")},on:{click:function(n){return t.$emit("clicked","en_preparation")}}},[t._v("En préparation "),e("span",{staticClass:"ml-2"},[t._v(t._s(t.enPreparationCount))])]),e("a",{class:{selected:t.statusFilters.includes("en_cours")},on:{click:function(n){return t.$emit("clicked","en_cours")}}},[t._v("En cours "),e("span",{staticClass:"ml-2"},[t._v(t._s(t.enCoursCount))])]),e("a",{class:{selected:t.statusFilters.includes("termine")},on:{click:function(n){return t.$emit("clicked","termine")}}},[t._v("Passés "),e("span",{staticClass:"ml-2"},[t._v(t._s(t.termineCount))])])])}),[],!1,null,"05a05490",null).exports),p=e("6FLb");function d(){var t=Object(i.a)(["\n          query {\n            items {\n              investigations(filter: { \n                promotion: { id: { _eq: "," } }\n              }) {\n                id\n                nom\n                status\n                mission\n                communes {\n                  commune: communes_id {\n                    nom\n                  }\n                }\n                departements {\n                  departement: departements_id {\n                    nom\n                  }\n                }\n                regions {\n                  region: regions_id {\n                    nom\n                  }\n                }\n                epcis {\n                  epci: epcis_id {\n                    nom\n                  }\n                }\n              }\n              promotions {\n                id\n                nom\n              }\n            }\n          }"]);return d=function(){return t},t}function f(){var t=Object(i.a)(["\n          query {\n            items {\n              investigations {\n                id\n                nom\n                status\n                mission\n                communes {\n                  commune: communes_id {\n                    nom\n                  }\n                }\n                departements {\n                  departement: departements_id {\n                    nom\n                  }\n                }\n                regions {\n                  region: regions_id {\n                    nom\n                  }\n                }\n                epcis {\n                  epci: epcis_id {\n                    nom\n                  }\n                }\n              }\n              promotions {\n                id\n                nom\n              }\n            }\n          }"]);return f=function(){return t},t}var v,h={props:{promotionId:String,allInvestigations:Boolean},components:{InvestigationCard:a,FiltresEtCarto:m},methods:{onStatusFilterClick:function(t){this.statusFilters.includes(t)?this.statusFilters=this.statusFilters.filter((function(n){return n!==t})):this.statusFilters.push(t)},onPromotionsChange:function(t){var n=t.target.value;"all"===n?this.$router.push("/investigations"):this.$router.push("/investigations/promotions/".concat(n))},fetchInvestigations:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark((function n(){var e,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=t.allInvestigations?Object(p.gql)(f()):Object(p.gql)(d(),t.promotionId),n.next=3,t.$graphql.request(e);case 3:i=n.sent,t.items=i.items;case 5:case"end":return n.stop()}}),n)})))()}},watch:{promotionId:(v=Object(s.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.fetchInvestigations();case 1:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)})},computed:{enPreparationCount:function(){return this.investigationsEnPreparation.length},enCoursCount:function(){return this.investigationsEnCours.length},termineCount:function(){return this.investigationsTermine.length},investigationsEnPreparation:function(){return this.items.investigations.filter((function(t){return"en_preparation"===t.status}))},investigationsEnCours:function(){return this.items.investigations.filter((function(t){return"en_cours"===t.status}))},investigationsTermine:function(){return this.items.investigations.filter((function(t){return"termine"===t.status}))},filteredInvestigations:function(){var t=this;return this.items.investigations.filter((function(n){return t.statusFilters.includes(n.status)})).map((function(t){var n=[];return t.communes.forEach((function(t){return n.push(t.commune.nom)})),t.departements.forEach((function(t){return n.push(t.departement.nom)})),t.regions.forEach((function(t){return n.push(t.region.nom)})),t.epcis.forEach((function(t){return n.push(t.epci.nom)})),t.collectivites=n,t}))}},data:function(){return{statusFilters:["en_cours","termine","en_preparation"],selectedPromotionsPath:this.promotionId?this.promotionId:"all",items:{investigations:[],promotions:[]}}},mounted:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.fetchInvestigations();case 1:case"end":return n.stop()}}),n)})))()}},g=(e("A06X"),Object(o.a)(h,(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"mx-auto max-w-screen-md"},[e("div",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedPromotionsPath,expression:"selectedPromotionsPath"}],staticClass:"select-promotions",attrs:{name:"promotions"},on:{change:[function(n){var e=Array.prototype.filter.call(n.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.selectedPromotionsPath=n.target.multiple?e:e[0]},t.onPromotionsChange]}},[e("option",{attrs:{value:"all"}},[t._v("Toutes les investigations")]),t._l(t.items.promotions,(function(n){return e("option",{key:n.id,domProps:{value:n.id}},[t._v("\n        "+t._s(n.nom)+"\n      ")])}))],2)]),e("FiltresEtCarto",{attrs:{enCoursCount:t.enCoursCount,termineCount:t.termineCount,enPreparationCount:t.enPreparationCount,statusFilters:t.statusFilters},on:{clicked:t.onStatusFilterClick}}),t._l(t.filteredInvestigations,(function(t){return e("InvestigationCard",{key:t.id,attrs:{id:t.id,status:t.status,name:t.nom,pitch:t.mission,collectivites:t.collectivites}})}))],2)}),[],!1,null,null,null));n.a=g.exports},hshw:function(t,n,e){},id0j:function(t,n,e){"use strict";var i={props:{pretitle:String}},s=(e("2YfZ"),e("KHd+")),r=Object(s.a)(i,(function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"page-title"},[this.$props.pretitle?n("h2",[this._v("\n    "+this._s(this.$props.pretitle)+"\n  ")]):this._e(),n("h1",[this._t("default")],2)])}),[],!1,null,null,null);n.a=r.exports},lMBz:function(t,n,e){},wKo5:function(t,n,e){},zvga:function(t,n,e){"use strict";e("lMBz")}}]);